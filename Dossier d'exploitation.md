# Dossier d'exploitation

### Version

| Auteur | Date | Description | Version |
| - | - | - | - |
| Benjamin C. | 07/05/2019 | Création du document | V1 | 

### Objet du document

Le présent document constitue le dossier d'exploitation de l'application oc-pizza.com.

Il a pour objectif de définir le système nécessaire à son fonctionnement, les instructions de déploiement, les instructions de maintenance et de surveillance.

## Système

### Application

L'application utilise le framework Django 2.2

### Serveur de base de données

Le SGDB utilisé est Postgres 10.7

Il est hébergé sur AWS

### Serveur web

Le serveur web utilisé est Nginx 1.16.0

le serveur HTTP WSGI Gunicorn est en version 19.9.0

Le système est démarré/redémarré par Supervisor 4.0.2

### Hébergement

l'Application est hébergé sur Amazon Web Service sur une instance EC2 Ubuntu Server 18.04 amd64

IP Public : 3.16.90.115

DNS : www.oc-pizza.com

### Autres composants

Les packages utilisés sont identifiés dans le fichier `Pipfile` à la racine du répertoire.

## Procédure de déploiement

Le code est hébergé sur Github sur un dépôt privé.

Une vérification des tests est effectué grace à Travis CI qui déploit automatiquement les mises à jour grace à Code Deploy de AWS.

l'installation des packages, La migration et la collecte des fichiers statics sont effectués directement par un script de déploiement.

Les variables d'environnement à définir avant le premier déploiement 

| Nom | Description | type de valeur |
| - | - | - |
| ENV | Variable définissant l'environnement de production | 'PRODUCTION' |
| SECRET_KEY | Variable de chiffrement nécessaire à Django| Variable aléatoire secreête sur 32 digits|
| NAME_DB | Nom de la base de donnée | 'OCPIZZA' |
| USER_DB | Nom de l'utilisateur Postgres | 'OCPIZUSER' |
| PASSWORD_DB | mot de passe de l'utilisateur Postgres | variable aléatoire sur 12 digits mini conseillé |
| EMAIL_HOST_PASSWORD | clé pour Sendgrid (Service d'email) | clé disponible sur le compte Sendgrid |

## Configuration

La configuration de l'application se trouve dans le fichier

    ~/oc_pizza/core/settings/production.py

les fichiers static se trouve dans ce dossier

    ~/oc_pizza/staticfiles

le fichier de configuration de nginx

    /etc/nginx/sites-enabled/oc-pizza.conf

le fichier de configuration de Supervisor

    /etc/supervisor/conf.d/oc-pizza.conf

## Procédures de maintenance

Une sauvegarde de la base de donnée à lieu tous les jours à 3h GMT dans un fichier nommé OCPDB_YYYYMMDD.sql dans un dossier `~/backup_db/`

Un historique de 14 jours est sauvegardé.

### L'application

Un systéme de 

## Outils de surveillance

### Surveillance du traffic

Le traffic de l'application est surveillé par Newrelic qui alertera si une activité intense met en défaut le serveur.

### Surveillance de l'application

L'application est surveillé par Sentry